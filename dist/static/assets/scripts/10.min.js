"use strict";angular.module("app",["angular-loading-bar","filters","validators","firebase","fire","routes","login","auctions","ui.bootstrap","angular-underscore","jlareau.pnotify"]).controller("AppController",["$scope","FireAuth",function(e,r){e.logout=function(){r.$unauth()},e.sizeOf=function(e){return"undefined"==typeof e&&(e={}),Object.keys(e).length},e.firstObj=function(e){for(var r in e)if(e.hasOwnProperty(r))return r}}]),angular.module("filters",[]).filter("trim",function(){return function(e){return angular.isString(e)?e.replace(/^\s+|\s+$/g,""):e}}).filter("capitalize",[function(){return function(e){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}]).directive("capitalize",["$filter",function(e){return{require:"ngModel",link:function(r,t,n,i){i.$parsers.push(function(r){var t=e("capitalize")(r);return t!=r&&(i.$setViewValue(t),i.$render()),t})}}}]).filter("slug",[function(){return function(e){return e?String(e).toLowerCase().replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," ").replace(/\s+/g,"-"):""}}]).filter("noSpecialChars",[function(){return function(e){return e?String(e).replace(/[^a-zá-źA-ZÁ-Ź0-9]/g," ").trim().replace(/\s{2,}/g," "):""}}]).filter("capitalizeFirstChar",[function(){return function(e){return e?e.trim().replace(/(^\w?)/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):""}}]).directive("capitalizeFirstChar",["$filter",function(e){return{require:"ngModel",link:function(r,t,n,i){i.$parsers.push(function(r){var t=e("capitalizeFirstChar")(r);return t!=r&&(i.$setViewValue(t),i.$render()),t})}}}]).filter("dateParse",["$window","$filter",function(e,r){return function(t,n,i){return t?r("date")(e.Date.parse(t),n,i):""}}]).filter("stringReplace",[function(){return function(e,r,t){return e.split(r).join(t)}}]).filter("reverse",[function(){return function(e){return angular.isArray(e)?e.slice().reverse():[]}}]).filter("camelCase",[function(){return function(e){return e?e.trim().replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(e,r){return 0===+e?"":0===r?e.toLowerCase():e.toUpperCase()}):""}}]).filter("lispCaseToCamelCase",[function(){return function(e){return e?e.trim().replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()}):""}}]).filter("bytes",[function(){return function(e,r){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof r&&(r=1);var t=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(r)+" "+t[n]}}]).filter("htmlToPlaintext",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm," ").trim():""}}]).filter("unsafe",["$sce",function(e){return e.trustAsHtml}]).filter("removeFileExtension",["$filter",function(e){return function(r){return r?e("stringReplace")(r,"."+r.split(".").pop(),"").trim():""}}]),angular.module("validators",[]).directive("noSpecialChars",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,n){n.$validators.noSpecialChars=function(e){return String(e).match(/[^a-zá-źA-ZÁ-Ź0-9\s]/g)?!1:!0}}}}),angular.module("fire",[]).constant("FIRE_BASE_URL","https://rtmg.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["facebook","twitter"]).constant("LOGIN_REDIRECT_PATH","/auctions").factory("FireAuth",["$firebaseAuth","FireRef",function(e,r){return e(r)}]).factory("FireRef",["$window","FIRE_BASE_URL",function(e,r){return new e.Firebase(r)}]).directive("ngHideAuth",["FireAuth","$timeout",function(e,r){return{restrict:"A",link:function(t,n){function i(){r(function(){n.toggleClass("ng-cloak",!!e.$getAuth())},0)}n.addClass("ng-cloak"),e.$onAuth(i),i()}}}]).directive("ngShowAuth",["FireAuth","$timeout",function(e,r){return{restrict:"A",link:function(t,n){function i(){r(function(){n.toggleClass("ng-cloak",!e.$getAuth())},0)}n.addClass("ng-cloak"),e.$onAuth(i),i()}}}]),angular.module("routes",["ngRoute"]).config(["$routeProvider","SECURED_ROUTES",function(e,r){e.whenAuthenticated=function(t,n){return n.resolve=n.resolve||{},n.resolve.user=["FireAuth",function(e){return e.$requireAuth()}],e.when(t,n),r[t]=!0,e}}]).config(["$routeProvider","$locationProvider",function(e,r){r.html5Mode(!0).hashPrefix("!"),e.when("/",{templateUrl:"static/assets/views/login.html",controller:"LoginController"}).whenAuthenticated("/auctions",{templateUrl:"static/assets/views/auctions.html",controller:"AuctionsController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","FireAuth","SECURED_ROUTES","LOGIN_REDIRECT_PATH",function(e,r,t,n,i){function o(e){!e&&a(r.path())&&r.path(i)}function a(e){return n.hasOwnProperty(e)}t.$onAuth(o),e.$on("$routeChangeError",function(e,t,n,o){"AUTH_REQUIRED"===o.toString()&&r.path(i)})}]).constant("SECURED_ROUTES",{}).constant("LOGIN_REDIRECT_PATH","/"),angular.module("login",["ngMessages"]).controller("LoginController",["$scope","FireAuth","$location","$q","FireRef","notificationService","$window","$log",function(e,r,t,n,i,o,a,c){function u(e){var r=n.defer(),t=i.child("users").child(e.uid),o={};return t.once("value",function(a){var c=null!==a.val();if(c)r.resolve();else{switch(e.provider){case"facebook":o.names=e.facebook.displayName,o.provider=e.provider;break;case"twitter":o.names=e.twitter.displayName,o.twitterAccount=e.twitter.username,o.provider=e.provider}o.balance=1e3;var u=i.child("inventories").child(e.uid),s={breads:30,carrots:18,diamonds:1};n.all([t.set(o),u.set(s)]).then(function(){r.resolve()},function(e){r.reject(e)})}}),r.promise}function s(){a.location="/auctions"}function l(e){switch(e.code){case"AUTHENTICATION_DISABLED":o.error("The requested authentication provider is disabled for this Firebase application.");break;case"EMAIL_TAKEN":o.error("The new user account cannot be created because the email is already in use.");break;case"INVALID_ARGUMENTS":o.error("The specified credentials are malformed or incomplete. Please refer to the error message, error details, and Firebase documentation for the required arguments for authenticating with this provider.");break;case"INVALID_CONFIGURATION":o.error("The requested authentication provider is misconfigured, and the request cannot complete. Please confirm that the provider 's client ID and secret are correct in your App Dashboard and the app is properly set up on the provider 's website.");break;case"INVALID_CREDENTIALS":o.error("The requested authentication provider is misconfigured, and the request cannot complete. Please confirm that the provider 's client ID and secret are correct in your App Dashboard and the app is properly set up on the provider 's website.");break;case"INVALID_EMAIL":o.error("The specified email is not a valid email.");break;case"INVALID_ORIGIN":o.error("A security error occurred while processing the authentication request. The web origin for the request is not in your list of approved request origins. To approve this origin, visit the Login & Auth tab in your App Dashboard.");break;case"INVALID_PASSWORD":o.error("The specified user account password is incorrect.");break;case"INVALID_PROVIDER":o.error("The requested authentication provider does not exist. Please consult the Firebase Authentication documentation for a list of supported providers.");break;case"INVALID_TOKEN":o.error("The specified authentication token is invalid. This can occur when the token is malformed, expired, or the Firebase app secret that was used to generate it has been revoked.");break;case"INVALID_USER":o.error("The specified user account does not exist.");break;case"NETWORK_ERROR":o.error("An error occurred while attempting to contact the authentication server.");break;case"PROVIDER_ERROR":o.error("A third-party provider error occurred. Please refer to the error message and error details for more information.");break;case"TRANSPORT_UNAVAILABLE":o.error("The requested login method is not available in the user's browser environment. Popups are not available in Chrome for iOS, iOS Preview Panes, or local, file:// URLs. Redirects are not available in PhoneGap / Cordova, or local, file:// URLs.");break;case"UNKNOWN_ERROR":o.error("An unknown error occurred. Please refer to the error message and error details for more information.");break;case"USER_CANCELLED":o.error("The current authentication request was cancelled by the user.");break;case"USER_DENIED":o.error("The user did not authorize the application. This error can occur when the user has cancelled an OAuth authentication request.");break;default:o.error("Undefined Error: ",e)}}null!==r.$getAuth()&&(a.location="/auctions"),e.oauthLogin=function(e){r.$authWithOAuthPopup(e,{rememberMe:!0}).then(function(e){return u(e)}).then(s,l)}}]),angular.module("auctions",["ngMessages","cgBusy"]).controller("AuctionsController",["$scope","$q","user","$uibModal","FireRef","$firebaseObject","$firebaseArray","notificationService","$log",function(e,r,t,n,i,o,a,c,u){function s(e){switch(e){case"escape key press":c.notice("This action was canceled by the user");break;case void 0:c.notice("This action was canceled by the user");break;case"backdrop click":c.notice("This action was canceled by the user");break;default:c.error(e)}}e.lording={deferred:r.defer(),isDone:!1,taskToDoFirst:[]},e.lording.promise=e.lording.deferred.promise,e.account={user:t,profile:o(i.child("users/"+t.uid)),queuedAuctions:a(i.child("auctions/").orderByChild("sellerID").equalTo(t.uid)),inventory:a(i.child("inventories/"+t.uid)),compromisedInventory:{}},e.currentAuction=o(i.child("currentAuction")),e.lording.taskToDoFirst.push(e.account.profile.$loaded()),e.lording.taskToDoFirst.push(e.account.inventory.$loaded()),e.lording.taskToDoFirst.push(e.account.queuedAuctions.$loaded()),e.lording.taskToDoFirst.push(e.currentAuction.$loaded()),r.all(e.lording.taskToDoFirst).then(function(){e.$watch(function(){return e.account.queuedAuctions.length},function(){e.account.compromisedInventory={},angular.forEach(e.account.queuedAuctions,function(r){e.account.compromisedInventory[r.itemDetails.name]="undefined"!=typeof e.account.compromisedInventory[r.itemDetails.name]?e.account.compromisedInventory[r.itemDetails.name]:0,e.account.compromisedInventory[r.itemDetails.name]+=r.quantityAuctioned})}),e.lording.deferred.resolve(),e.lording.isDone=!0},function(e){c.error(e)}),e.forms={placeBid:{}};var l=angular.copy(e.model={bid:null});e.$watch(function(){return e.currentAuction.timeLeft},function(){var r=angular.copy(e.currentAuction);0===r.timeLeft&&""!==r.bidderID&&c.notifyWithDefaults({title:"The auction is over, the the winner is:",text:"<b>"+r.sellerDetails.names+"</b>, for "+r.winningBid+" coins.",delay:1e4,type:"success"}),0===e.currentAuction.timeLeft&&""===e.currentAuction.bidderID&&c.notice("The last auction is over there was no winner.")}),e.submit=function(){e.forms.placeBid.$valid&&(e.currentAuction.bidderID=e.account.profile.$id,e.currentAuction.winningBid=e.model.bid,e.currentAuction.winningBidderDetails=e.account.profile,e.currentAuction.$save().then(function(){e.model=angular.copy(l),e.forms.placeBid.$setUntouched(),e.forms.placeBid.$setPristine(),c.success("The bid has been placed.")},function(e){c.error(e)}))},e.auction=function(r,t,i){if(angular.isDefined(t)&&t<r.$value||!angular.isDefined(t)){var o=n.open({templateUrl:"auctionModal.html",controller:"AuctionModalController",size:i,resolve:{item:function(){return r},compromisedInventory:function(){return t},profile:function(){return e.account.profile}}});o.result.then(function(){c.success("The auction offer has been added.")},function(e){s(e)})}else c.error("You have already all the "+r.$id+" inventory compromised.")}}]).controller("AuctionModalController",["$scope","$modalInstance","$window","item","compromisedInventory","profile","FireRef","$firebaseArray",function(e,r,t,n,i,o,a,c){e.forms={auctionDetails:{}},e.item=n,e.compromisedInventory=i,e.model={quantityAuctioned:null,minimumBid:null},e.submit=function(){if(e.forms.auctionDetails.$valid){var t={quantityAuctioned:e.model.quantityAuctioned,minimumBid:e.model.minimumBid,itemDetails:{name:n.$id},sellerDetails:o,sellerID:o.$id,winningBid:0,bidderID:"",winningBidderDetails:{names:""},timeLeft:90,startedAt:Firebase.ServerValue.TIMESTAMP},i=c(a.child("auctions"));e.httpRequestPromise=i.$add(t).then(function(e){r.close()},function(e){r.dismiss(e)})}},e.cancel=function(){r.dismiss()}}]).directive("integer",function(){return{require:"ngModel",link:function(e,r,t,n){n.$validators.integer=function(e,r){if(n.$isEmpty(e))return!0;var t=/^\-?\d+$/;return t.test(r)?!0:!1}}}});